<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>html5上传图片 | TVVT</title>
  <meta name="author" content="tvvt">
  
  <meta name="description" content="相信奇迹，相信梦想">
  
  
  <meta property="og:title" content="html5上传图片"/>
  <meta property="og:site_name" content="TVVT"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <link rel="apple-touch-icon" href="/images/6659684.png" title="TVVT" >
   <link rel="shortcut icon" href="/images/6659684.png" title="TVVT" >
   <link rel="alternate" href="/atom.xml" title="TVVT" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>-->
  <script src="/js/jquery-1.8.3.min.js"></script>
  <script src="/js/index.js"></script>
</head>


<body>
  <div id="content" class="inner clearfix">
    <aside id="sidebar" class="alignleft animated fadeInLeft">
      <div class="navigationBar">
      <a class="imgIcon" href="https://github.com/TVVT"><img src="/images/6659684.png" alt=""></a>
        <a href="/">TVVT</a>
      </div>
    	
  <div class="widget search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
  <form method="get" class="searchform" action="http://localhost:5000/">
	<input type="text" value="Type then hit enter to search" onblur="if(this.value == '') { this.value='Type then hit enter to search'}" onfocus="if (this.value == 'Type then hit enter to search') {this.value=''}" name="s" class="searchbar">
	<input type="hidden" class="searchsubmit" value="Search">
	</form><div class="clear"></div>
</div>

  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
      <li class="cell"><a class="next" href="/atom.xml">Subscribe</a><li>
    
    </ul>
</nav>

  <div class="widget member clearfix">
	<a href="https://github.com/fangcao7618"><img src="/images/1916867.png" alt=""></a>
	<a href="https://github.com/huangkemin"><img src="/images/1684527.png" alt=""></a>
	<a href="https://github.com/wov"><img src="/images/1091511.jpeg" alt=""></a>
	<a href="https://github.com/lb1064"><img src="/images/1217562.jpeg" alt=""></a>
	<a href="https://github.com/wchaowu"><img src="/images/131735.jpeg" alt=""></a>
	<a href="https://github.com/luckyrobin"><img src="/images/3426945.jpeg" alt=""></a>
	<a href="https://github.com/kevin14"><img src="/images/2288763.png" alt=""></a>
	<a href="https://github.com/Sunny-JJ"><img src="/images/6659860.png" alt=""></a>
	<a href="https://github.com/ximan"><img src="/images/2944289.jpeg" alt=""></a>
	<a href="https://github.com/InsCake"><img src="/images/3214484.png" alt=""></a>
</div>

  

  
<div class="widget tagcloud">
  <h3 class="title">Tags</h3>
  <div class="entry">
    <a href="/tags/Effective/" style="font-size: 10.00px;">Effective</a><a href="/tags/HTML5/" style="font-size: 10.00px;">HTML5</a><a href="/tags/Hack/" style="font-size: 10.00px;">Hack</a><a href="/tags/Jade/" style="font-size: 10.00px;">Jade</a><a href="/tags/JavaScript/" style="font-size: 10.00px;">JavaScript</a><a href="/tags/Mac/" style="font-size: 10.00px;">Mac</a><a href="/tags/Mixins/" style="font-size: 10.00px;">Mixins</a><a href="/tags/Nodejs/" style="font-size: 10.00px;">Node.js</a><a href="/tags/Notes/" style="font-size: 10.00px;">Notes</a><a href="/tags/Objective-C/" style="font-size: 10.00px;">Objective-C</a><a href="/tags/Other/" style="font-size: 10.00px;">Other</a><a href="/tags/Raspberry-Pi/" style="font-size: 10.00px;">Raspberry Pi</a><a href="/tags/Sinppets/" style="font-size: 10.00px;">Sinppets</a><a href="/tags/Unix/" style="font-size: 10.00px;">Unix</a><a href="/tags/Web/" style="font-size: 10.00px;">Web</a><a href="/tags/Xcode/" style="font-size: 10.00px;">Xcode</a><a href="/tags/clang/" style="font-size: 10.00px;">clang</a><a href="/tags/easyXDM/" style="font-size: 10.00px;">easyXDM</a><a href="/tags/form/" style="font-size: 10.00px;">form</a><a href="/tags/iOS/" style="font-size: 10.00px;">iOS</a><a href="/tags/iscroll/" style="font-size: 10.00px;">iscroll</a><a href="/tags/llvm/" style="font-size: 10.00px;">llvm</a><a href="/tags/runtime/" style="font-size: 10.00px;">runtime</a><a href="/tags/svg/" style="font-size: 10.00px;">svg</a><a href="/tags/vml/" style="font-size: 10.00px;">vml</a><a href="/tags/分页控件/" style="font-size: 10.00px;">分页控件</a><a href="/tags/只读经典/" style="font-size: 10.00px;">只读经典</a><a href="/tags/图片处理/" style="font-size: 10.00px;">图片处理</a><a href="/tags/技术/" style="font-size: 10.00px;">技术</a><a href="/tags/正则表达式/" style="font-size: 10.00px;">正则表达式</a><a href="/tags/照片/" style="font-size: 20.00px;">照片</a>
  </div>
</div>


  

    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2014 tvvt
  
</div>


<div style="position:relative; bottom: 23px">
  <script src="http://s95.cnzz.com/stat.php?id=1&web_id=1&show=pic1" language="JavaScript">
  </script>
</div>


</footer>
    </aside>
    
    
    <div id="hidden-navigationBar" class="navigationBar">
      <a class="imgIcon" href="https://github.com/TVVT"><img src="/images/6659684.png" alt=""></a>
      <a href="/">TVVT</a>
    </div>
    <div id="main-col" class="alignright">
      <div id="wrapper" class="animated fadeInRight" >
      
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content animated fadeInRight">
  <header>
      
      
  
    <h1 class="title">html5上传图片</h1>
  

      <time datetime="2014-06-11T08:03:42.000Z"><a href="/2014/06/11/picture-upload/">Jun 11 2014</a></time>
      
  </header>

<div class="entry ">


    <!--toc--> 
    
    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#概要"><span class="toc-number">1.</span> <span class="toc-text">概要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#上传文件"><span class="toc-number">2.</span> <span class="toc-text">上传文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取文件"><span class="toc-number">3.</span> <span class="toc-text">获取文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#预览文件"><span class="toc-number">4.</span> <span class="toc-text">预览文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#上传文件并显示上传进度"><span class="toc-number">5.</span> <span class="toc-text">上传文件并显示上传进度</span></a></li></ol>
    </div>
    
    <!--end-->
  <h3 id="概要">概要</h3>
<p>html5上传图片其实非常简单。而且功能也比较强大。</p>
<p>可以用的api 包括 ：  File , ajax    level 2, formdata , drag &amp; drop , createObjectURL , base64 等。</p>
<p>它们都非常简单且易用。下面按照流程来讲这些可能会用用到的apis。</p>
<p><a id="more"></a></p>
<h3 id="上传文件">上传文件</h3>
<p>传统的上传文件使用的是表单。</p>
<pre><code>&lt;input <span class="keyword">type</span>=<span class="string">"file"</span> /&gt; 
</code></pre><p>我们也可以添加一些属性。用法如下：</p>
<pre><code>&lt;input <span class="keyword">type</span>=<span class="string">"file"</span> accept=<span class="string">"image/*"</span> <span class="string">"multiple"</span>=<span class="string">"multiple"</span> /&gt;
</code></pre><p>其中 accept 表明接受的MIME type。这里表示所有的图片文件。当调用系统控件的时候，会过滤掉不支持的结果。</p>
<p>而 multiple 就是是否允许上传多张还是 只允许上传一张。</p>
<p>目前几乎支持所有的浏览器。</p>
<p>但是在移动端。ios6以下（不包含6）的safari是不支持的。WP ie10(包含ie10)以下版本是不支持的。</p>
<p>除了input以外，html5新增了 drag &amp; drop 。 这里可以看到<a href="http://html5demos.com/file-api" target="_blank">例子</a>。</p>
<p>不过需要注意的是，目前移动平台应该都是不支持的。问题是叫它怎么支持呢？</p>
<h3 id="获取文件">获取文件</h3>
<p>之前处理图片文件的时候，我们很多时候是先传到服务器，让服务器判断文件大小、尺寸是否合法。然后再给出结果。</p>
<p>如果你使用html5的话，根本没有必要这么做。这样节省成本，和获得更好的体验。</p>
<p>如果使用input的话。我们是这样取得文件的。</p>
<pre><code>_input.addEventListener(<span class="string">'change'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">var</span> files = _input.files;
    <span class="comment">// do somthing with your files</span>
});
</code></pre><p>这里注意的是 不管你是否含有 multiple 属性。你获得的始终是一个数组。</p>
<p>使用drag &amp; drop的代码如下：</p>
<pre><code>FU.addEventListener(<span class="string">'dragenter'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
}, <span class="literal">false</span>); 
FU.addEventListener(<span class="string">'dragleave'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
}, <span class="literal">false</span>);
FU.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
}, <span class="literal">false</span>);
FU.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
    <span class="keyword">var</span> files = e.dataTransfer.files;
    <span class="comment">//do somthing with your files</span>
}, <span class="literal">false</span>);
</code></pre><p>首先要注意的是：虽然我没有对 dragenter 、 dragleave 、dragover 等事件做什么处理。（当然你可以做些样式的改变来响应用户的操作）但是还是阻止浏览器默认的操作。</p>
<p>不然的话，浏览器很有可能在新窗口中打开图片。</p>
<h3 id="预览文件">预览文件</h3>
<p>html5可以使用file api 读取文件，并输出base64的格式。然后 使用 image 显示出来。</p>
<pre><code><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();
reader.onload = <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> {</span>
    <span class="keyword">var</span> src = event.target.result;
    <span class="comment">//do somthing width your src</span>
    };
reader.readAsDataURL(file);
</code></pre><p>但是其实没有必要这么麻烦。我们可以使用windows.URL.createObjectURL</p>
<pre><code><span class="reserved">var</span> WINURL = <span class="built_in">window</span>.URL || <span class="built_in">window</span>.webkitURL;
<span class="reserved">var</span> src = WINURL.createObjectURL(file);
<span class="regexp">//</span><span class="keyword">do</span> somthing width your src
</code></pre><p>需要注意的是当使用完成之后需要注销，不然会占据着内存</p>
<pre><code>WINURL<span class="preprocessor">.revokeObjectURL</span>(src)<span class="comment">;</span>
</code></pre><h3 id="上传文件并显示上传进度">上传文件并显示上传进度</h3>
<p>上传使用ajax POST。</p>
<p>代码如下：</p>
<pre><code><span class="keyword">var</span> formdata = <span class="keyword">new</span> FormData();
formdata.append(<span class="string">'file'</span> , file);

<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();
<span class="keyword">var</span> upload = xhr.upload;

upload.addEventListener(<span class="string">"progress"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(ev)</span> {</span>
    <span class="keyword">if</span> (ev.lengthComputable) {
        console.log(ev.loaded/ev.total);
    }
},<span class="literal">false</span>);

xhr.onreadystatechange = <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">if</span>(xhr.readyState === <span class="number">4</span>){
         <span class="comment">//do somthing width your respose.</span>
    }
};

xhr.open(<span class="string">'POST'</span>,url); <span class="comment">//url 是表单的提交地址。</span>
xhr.send(formdata);
</code></pre><p>是不是特别简单呢。</p>


  
    <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2120066534/home?wvr=5&amp;s=6cm7D0"><strong>施峰峰</strong></a> - Jun 11 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://yoursite.com"><strong>TVVT</strong></a></span>
</p>
  


</div>

    <!--<div class="entry">
      
      <h3 id="概要">概要</h3>
<p>html5上传图片其实非常简单。而且功能也比较强大。</p>
<p>可以用的api 包括 ：  File , ajax    level 2, formdata , drag &amp; drop , createObjectURL , base64 等。</p>
<p>它们都非常简单且易用。下面按照流程来讲这些可能会用用到的apis。</p>
<p><a id="more"></a></p>
<h3 id="上传文件">上传文件</h3>
<p>传统的上传文件使用的是表单。</p>
<pre><code>&lt;input <span class="keyword">type</span>=<span class="string">"file"</span> /&gt; 
</code></pre><p>我们也可以添加一些属性。用法如下：</p>
<pre><code>&lt;input <span class="keyword">type</span>=<span class="string">"file"</span> accept=<span class="string">"image/*"</span> <span class="string">"multiple"</span>=<span class="string">"multiple"</span> /&gt;
</code></pre><p>其中 accept 表明接受的MIME type。这里表示所有的图片文件。当调用系统控件的时候，会过滤掉不支持的结果。</p>
<p>而 multiple 就是是否允许上传多张还是 只允许上传一张。</p>
<p>目前几乎支持所有的浏览器。</p>
<p>但是在移动端。ios6以下（不包含6）的safari是不支持的。WP ie10(包含ie10)以下版本是不支持的。</p>
<p>除了input以外，html5新增了 drag &amp; drop 。 这里可以看到<a href="http://html5demos.com/file-api" target="_blank">例子</a>。</p>
<p>不过需要注意的是，目前移动平台应该都是不支持的。问题是叫它怎么支持呢？</p>
<h3 id="获取文件">获取文件</h3>
<p>之前处理图片文件的时候，我们很多时候是先传到服务器，让服务器判断文件大小、尺寸是否合法。然后再给出结果。</p>
<p>如果你使用html5的话，根本没有必要这么做。这样节省成本，和获得更好的体验。</p>
<p>如果使用input的话。我们是这样取得文件的。</p>
<pre><code>_input.addEventListener(<span class="string">'change'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">var</span> files = _input.files;
    <span class="comment">// do somthing with your files</span>
});
</code></pre><p>这里注意的是 不管你是否含有 multiple 属性。你获得的始终是一个数组。</p>
<p>使用drag &amp; drop的代码如下：</p>
<pre><code>FU.addEventListener(<span class="string">'dragenter'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
}, <span class="literal">false</span>); 
FU.addEventListener(<span class="string">'dragleave'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
}, <span class="literal">false</span>);
FU.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
}, <span class="literal">false</span>);
FU.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
    e.preventDefault();
    <span class="keyword">var</span> files = e.dataTransfer.files;
    <span class="comment">//do somthing with your files</span>
}, <span class="literal">false</span>);
</code></pre><p>首先要注意的是：虽然我没有对 dragenter 、 dragleave 、dragover 等事件做什么处理。（当然你可以做些样式的改变来响应用户的操作）但是还是阻止浏览器默认的操作。</p>
<p>不然的话，浏览器很有可能在新窗口中打开图片。</p>
<h3 id="预览文件">预览文件</h3>
<p>html5可以使用file api 读取文件，并输出base64的格式。然后 使用 image 显示出来。</p>
<pre><code><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();
reader.onload = <span class="function"><span class="keyword">function</span> <span class="params">(event)</span> {</span>
    <span class="keyword">var</span> src = event.target.result;
    <span class="comment">//do somthing width your src</span>
    };
reader.readAsDataURL(file);
</code></pre><p>但是其实没有必要这么麻烦。我们可以使用windows.URL.createObjectURL</p>
<pre><code><span class="reserved">var</span> WINURL = <span class="built_in">window</span>.URL || <span class="built_in">window</span>.webkitURL;
<span class="reserved">var</span> src = WINURL.createObjectURL(file);
<span class="regexp">//</span><span class="keyword">do</span> somthing width your src
</code></pre><p>需要注意的是当使用完成之后需要注销，不然会占据着内存</p>
<pre><code>WINURL<span class="preprocessor">.revokeObjectURL</span>(src)<span class="comment">;</span>
</code></pre><h3 id="上传文件并显示上传进度">上传文件并显示上传进度</h3>
<p>上传使用ajax POST。</p>
<p>代码如下：</p>
<pre><code><span class="keyword">var</span> formdata = <span class="keyword">new</span> FormData();
formdata.append(<span class="string">'file'</span> , file);

<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();
<span class="keyword">var</span> upload = xhr.upload;

upload.addEventListener(<span class="string">"progress"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(ev)</span> {</span>
    <span class="keyword">if</span> (ev.lengthComputable) {
        console.log(ev.loaded/ev.total);
    }
},<span class="literal">false</span>);

xhr.onreadystatechange = <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">if</span>(xhr.readyState === <span class="number">4</span>){
         <span class="comment">//do somthing width your respose.</span>
    }
};

xhr.open(<span class="string">'POST'</span>,url); <span class="comment">//url 是表单的提交地址。</span>
xhr.send(formdata);
</code></pre><p>是不是特别简单呢。</p>

	    
	    <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/u/2120066534/home?wvr=5&amp;s=6cm7D0"><strong>施峰峰</strong></a> - Jun 11 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://yoursite.com"><strong>TVVT</strong></a></span>
</p>
      
      
    </div>-->
    <footer>
      
	 
     		  
       		
  
  <div class="tags">
    <a href="/tags/图片处理/">图片处理</a>
  </div>

     		  
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style addthis addthis_toolbox addthis_default_style" style="color: black">
	<span class="jiathis_txt"></span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1784645" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2120066534" charset="utf-8"></script>
<!-- JiaThis Button END -->

       	 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>
<div id="uyan_frame"></div>
<script type="text/javascript" id="UYScript" src="http://v1.uyan.cc/js/iframe.js?UYUserId=1" async=""></script>
</section>


      </div>
      <div id="totop" style="position:fixed;bottom:50px;right:30px;cursor: pointer;">
<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>
      <script src="/js/totop.js"></script>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
      <div class="tabbaritem"><a class="next" href="/atom.xml">Subscribe</a></div>
    
</div>


  </div>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>